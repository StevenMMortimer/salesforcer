<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working with Attachments • salesforcer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working with Attachments">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-98603021-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-98603021-2');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">salesforcer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-book"></span> Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/supported-queries.html">Supported Queries</a></li>
    <li><a class="dropdown-item" href="../articles/working-with-bulk-apis.html">Working with Bulk APIs</a></li>
    <li><a class="dropdown-item" href="../articles/working-with-reports.html">Working with Reports</a></li>
    <li><a class="dropdown-item" href="../articles/working-with-attachments.html">Working with Attachments</a></li>
    <li><a class="dropdown-item" href="../articles/working-with-metadata.html">Working with Metadata</a></li>
    <li><a class="dropdown-item" href="../articles/passing-control-args.html">Passing Control Args</a></li>
    <li><a class="dropdown-item" href="../articles/transitioning-from-RForcecom.html">Transitioning from RForcecom</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-code-o"></span> Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/StevenMMortimer/salesforcer"><span class="fa fa-github fa-lg"></span> GitHub</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Working with Attachments</h1>
                        <h4 data-toc-skip class="author">Steven M.
Mortimer</h4>
            
            <h4 data-toc-skip class="date">2020-08-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/StevenMMortimer/salesforcer/blob/main/vignettes/working-with-attachments.Rmd" class="external-link"><code>vignettes/working-with-attachments.Rmd</code></a></small>
      <div class="d-none name"><code>working-with-attachments.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="attachments-in-salesforce">Attachments in Salesforce<a class="anchor" aria-label="anchor" href="#attachments-in-salesforce"></a>
</h2>
<p>Almost all records in Salesforce support attachments. Attachments are
just blob data storage for an associated ParentId. A ParentId is the
18-character Salesforcer Id of the record that the attachment belongs
to. To get started creating and updating attachments, first, load the
{salesforcer} and {dplyr} packages and login, if needed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/StevenMMortimer/salesforcer" class="external-link">salesforcer</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/sf_auth.html">sf_auth</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The Attachment data, for example, the attachment’s Id, ParentId,
Name, Body, ModifiedDate, and other attributes are stored in the
Attachment object, a Standard Object in Salesforce.</p>
</div>
<div class="section level2">
<h2 id="creating-uploading-attachments">Creating (Uploading) Attachments<a class="anchor" aria-label="anchor" href="#creating-uploading-attachments"></a>
</h2>
<p>Below we will cover 2 different methods of creating attachments:</p>
<ol style="list-style-type: decimal">
<li>Uploading local files as Attachments one at a time using the SOAP
and REST API (most common usage)</li>
<li>Uploading large batches of files using the Bulk API, which zips the
files before upload</li>
</ol>
<p><strong>Uploading local files as Attachments (SOAP and
REST)</strong></p>
<p>When uploading an attachment stored locally (i.e. on your computer),
you can provide an absolute or relative path to the current working
directory. If the <code>Name</code> column is omitted, then the name of
the attachment as it appears in Salesforce will be the same as the base
file name and extension. For example, if the path provided is
“/Documents/attachments/doc1.pdf”, then the <code>Name</code> field will
be set to “doc1.pdf”.</p>
<p>In the example below, we upload three attachments to two different
parent records. Note: Make sure to replace the paths and ParentIds in
the example below with file paths that exist on your local machine and
Ids of records in your Salesforce org.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define the ParentIds where the attachments will be shown in Salesforce</span></span>
<span><span class="va">parent_record_id1</span> <span class="op">&lt;-</span> <span class="st">"0016A0000035mJ4"</span></span>
<span><span class="va">parent_record_id2</span> <span class="op">&lt;-</span> <span class="st">"0016A0000035mJ5"</span></span>
<span></span>
<span><span class="co"># provide the file paths of where the attachments exist locally on your machine</span></span>
<span><span class="co"># in this case we are referencing images included within the salesforcer package, </span></span>
<span><span class="co"># but any absolute or relative path locally will work</span></span>
<span><span class="va">file_path1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"cloud.png"</span>, package<span class="op">=</span><span class="st">"salesforcer"</span><span class="op">)</span></span>
<span><span class="va">file_path2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"logo.png"</span>, package<span class="op">=</span><span class="st">"salesforcer"</span><span class="op">)</span></span>
<span><span class="va">file_path3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"old-logo.png"</span>, package<span class="op">=</span><span class="st">"salesforcer"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a data.frame or tbl_df out of this information</span></span>
<span><span class="va">attachment_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>Body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">file_path1</span>, </span>
<span>                                          <span class="va">file_path2</span>, </span>
<span>                                          <span class="va">file_path3</span><span class="op">)</span>, </span>
<span>                                        times<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                             ParentId <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">parent_record_id1</span>, </span>
<span>                                              <span class="va">parent_record_id2</span><span class="op">)</span>, </span>
<span>                                            each<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create the attachments!</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sf_create_attachment.html">sf_create_attachment</a></span><span class="op">(</span><span class="va">attachment_details</span><span class="op">)</span></span>
<span><span class="va">result</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   id                 success</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 00PKg000001EiCWMA0 TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 00PKg000001EiCbMAK TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 00PKg000001EiCgMAK TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 00PKg000001EiClMAK TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 00PKg000001Ei3fMAC TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more row</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="downloading-attachments">Downloading Attachments<a class="anchor" aria-label="anchor" href="#downloading-attachments"></a>
</h2>
<p>After uploading attachments to Salesforce you can download them by
first querying the metadata in the Attachment object. This metadata
provides the Id for the blob data attachment for download. A convenience
function, <code><a href="../reference/sf_download_attachment.html">sf_download_attachment()</a></code>, has been created to
download attachments quickly. The example below shows how to query the
metadata of attachments belonging to particular ParentId.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pull down all attachments associated with a particular record</span></span>
<span><span class="va">queried_attachments</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sf_query.html">sf_query</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"SELECT Id, Body, Name, ParentId</span></span>
<span><span class="st">                                         FROM Attachment</span></span>
<span><span class="st">                                         WHERE ParentId IN ('%s', '%s')"</span>, </span>
<span>                                         <span class="va">parent_record_id1</span>, <span class="va">parent_record_id2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">queried_attachments</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 4</span></span></span>
<span><span class="co">#&gt;   Id                 Body                                         Name  ParentId</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 00PKg000001EiCbMAK /services/data/v61.0/sobjects/Attachment/00… logo… 0016A00…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 00PKg000001EiCWMA0 /services/data/v61.0/sobjects/Attachment/00… clou… 0016A00…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 00PKg000001EgtEMAS /services/data/v61.0/sobjects/Attachment/00… old-… 0016A00…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 00PKg000001EiCgMAK /services/data/v61.0/sobjects/Attachment/00… old-… 0016A00…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 00PKg000001EiCqMAK /services/data/v61.0/sobjects/Attachment/00… old-… 0016A00…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more rows</span></span></span></code></pre></div>
<p>Before downloading the attachments using the Body it is important to
consider whether the attachment names are repeated or duplicates. If so,
then the attachments with the same exact name will be overwritten on the
local filesystem as they are downloaded. To avoid this problem there are
two common strategies:</p>
<ol style="list-style-type: decimal">
<li>Create a new column (e.g. <code>unique_name</code>) that is the
concatenation of the Attachment Id and the Attachment’s name which is
guaranteed to be unique.</li>
<li>Save the attachments in separate folders for each ParentId
record.</li>
</ol>
<p>As long as the same ParentId record doesn’t name attachments with the
same name, then Strategy #2 above will work. In addition, it may help
better organize the documents if you are planning to download many and
then upload again to Salesforce using the Bulk API as demonstrated later
in this script.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a new folder for each ParentId in the dataset</span></span>
<span><span class="va">temp_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">pid</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">queried_attachments</span><span class="op">$</span><span class="va">ParentId</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="va">pid</span><span class="op">)</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># ignore if already exists</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># create a new columns in the queried data so that we can pass this information </span></span>
<span><span class="co"># on to the function `sf_download_attachment()` that will actually perform the download</span></span>
<span><span class="va">queried_attachments</span> <span class="op">&lt;-</span> <span class="va">queried_attachments</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Strategy 1: Unique file names (ununsed here, but shown as an example)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>unique_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">Id</span>, <span class="va">Name</span>, sep<span class="op">=</span><span class="st">'___'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Strategy 2: Separate folders per parent</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="va">ParentId</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># download all of the attachments for a single ParentId record to their own folder</span></span>
<span><span class="va">download_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">sf_download_attachment</span>, </span>
<span>                          body <span class="op">=</span> <span class="va">queried_attachments</span><span class="op">$</span><span class="va">Body</span>, </span>
<span>                          name <span class="op">=</span> <span class="va">queried_attachments</span><span class="op">$</span><span class="va">Name</span>, </span>
<span>                          path <span class="op">=</span> <span class="va">queried_attachments</span><span class="op">$</span><span class="va">Path</span><span class="op">)</span></span>
<span><span class="va">download_result</span></span>
<span><span class="co">#&gt;                               /services/data/v61.0/sobjects/Attachment/00PKg000001EiCbMAK/Body </span></span>
<span><span class="co">#&gt;     "/var/folders/g6/rgtlsw6n123b0gt5483s5_cm0000gn/T//RtmpOywQ2o/0016A0000035mJ4QAI/logo.png" </span></span>
<span><span class="co">#&gt;                               /services/data/v61.0/sobjects/Attachment/00PKg000001EiCWMA0/Body </span></span>
<span><span class="co">#&gt;    "/var/folders/g6/rgtlsw6n123b0gt5483s5_cm0000gn/T//RtmpOywQ2o/0016A0000035mJ4QAI/cloud.png" </span></span>
<span><span class="co">#&gt;                               /services/data/v61.0/sobjects/Attachment/00PKg000001EgtEMAS/Body </span></span>
<span><span class="co">#&gt; "/var/folders/g6/rgtlsw6n123b0gt5483s5_cm0000gn/T//RtmpOywQ2o/0016A0000035mJ4QAI/old-logo.png" </span></span>
<span><span class="co">#&gt;                               /services/data/v61.0/sobjects/Attachment/00PKg000001EiCgMAK/Body </span></span>
<span><span class="co">#&gt; "/var/folders/g6/rgtlsw6n123b0gt5483s5_cm0000gn/T//RtmpOywQ2o/0016A0000035mJ4QAI/old-logo.png" </span></span>
<span><span class="co">#&gt;                               /services/data/v61.0/sobjects/Attachment/00PKg000001EiCqMAK/Body </span></span>
<span><span class="co">#&gt; "/var/folders/g6/rgtlsw6n123b0gt5483s5_cm0000gn/T//RtmpOywQ2o/0016A0000035mJ5QAI/old-logo.png" </span></span>
<span><span class="co">#&gt;                               /services/data/v61.0/sobjects/Attachment/00PKg000001EiClMAK/Body </span></span>
<span><span class="co">#&gt;    "/var/folders/g6/rgtlsw6n123b0gt5483s5_cm0000gn/T//RtmpOywQ2o/0016A0000035mJ5QAI/cloud.png" </span></span>
<span><span class="co">#&gt;                               /services/data/v61.0/sobjects/Attachment/00PKg000001Ei3fMAC/Body </span></span>
<span><span class="co">#&gt;     "/var/folders/g6/rgtlsw6n123b0gt5483s5_cm0000gn/T//RtmpOywQ2o/0016A0000035mJ5QAI/logo.png" </span></span>
<span><span class="co">#&gt;                               /services/data/v61.0/sobjects/Attachment/00PKg000001EgtFMAS/Body </span></span>
<span><span class="co">#&gt;    "/var/folders/g6/rgtlsw6n123b0gt5483s5_cm0000gn/T//RtmpOywQ2o/0016A0000035mJ5QAI/cloud.png" </span></span>
<span><span class="co">#&gt;                               /services/data/v61.0/sobjects/Attachment/00PKg000001EgtGMAS/Body </span></span>
<span><span class="co">#&gt;     "/var/folders/g6/rgtlsw6n123b0gt5483s5_cm0000gn/T//RtmpOywQ2o/0016A0000035mJ5QAI/logo.png" </span></span>
<span><span class="co">#&gt;                               /services/data/v61.0/sobjects/Attachment/00PKg000001EgtHMAS/Body </span></span>
<span><span class="co">#&gt; "/var/folders/g6/rgtlsw6n123b0gt5483s5_cm0000gn/T//RtmpOywQ2o/0016A0000035mJ5QAI/old-logo.png"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="updating-attachments">Updating Attachments<a class="anchor" aria-label="anchor" href="#updating-attachments"></a>
</h2>
<p>Once an Attachment record is created, you are still able to update
the content and metadata (<code>Name</code>, <code>IsPrivate</code>, and
<code>OwnerId</code>) for the record. The
<code><a href="../reference/sf_update_attachment.html">sf_update_attachment()</a></code> function works just like
<code><a href="../reference/sf_update.html">sf_update()</a></code> except that you will need to include the
<code>Body</code> column where the content of the attachment is help.
<strong>NOTE</strong>: If you just want to update the metadata and not
the Attachment content itself, you can simply use
<code><a href="../reference/sf_update.html">sf_update()</a></code> to modify fields other than the
<code>Body</code> field on the record.</p>
<p>The example below demonstrates how to add an attachment to a record,
then download it, zip it, re-upload to the record in order to save disk
space in your Org.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># upload a PDF to a particular record as an Attachment</span></span>
<span><span class="va">file_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                         <span class="st">"data-wrangling-cheatsheet.pdf"</span>,</span>
<span>                         package <span class="op">=</span> <span class="st">"salesforcer"</span><span class="op">)</span></span>
<span><span class="va">parent_record_id</span> <span class="op">&lt;-</span> <span class="st">"0036A000002C6MmQAK"</span> <span class="co"># replace with your own ParentId!</span></span>
<span><span class="va">attachment_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>Body <span class="op">=</span> <span class="va">file_path</span>, ParentId <span class="op">=</span> <span class="va">parent_record_id</span><span class="op">)</span></span>
<span><span class="va">create_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sf_create_attachment.html">sf_create_attachment</a></span><span class="op">(</span><span class="va">attachment_details</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># download, zip, and re-upload the PDF</span></span>
<span><span class="va">pdf_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sf_download_attachment.html">sf_download_attachment</a></span><span class="op">(</span>sf_id <span class="op">=</span> <span class="va">create_result</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">zipped_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">pdf_path</span>, <span class="st">".zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/zip.html" class="external-link">zip</a></span><span class="op">(</span><span class="va">zipped_path</span>, <span class="va">pdf_path</span>, flags <span class="op">=</span> <span class="st">"-qq"</span><span class="op">)</span> <span class="co"># quiet zipping messages</span></span>
<span><span class="va">attachment_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>Id <span class="op">=</span> <span class="va">create_result</span><span class="op">$</span><span class="va">id</span>, Body <span class="op">=</span> <span class="va">zipped_path</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/sf_update_attachment.html">sf_update_attachment</a></span><span class="op">(</span><span class="va">attachment_details</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   id                 success</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 00PKg000001EiCvMAK TRUE</span></span></code></pre></div>
<p>There is a function <code><a href="../reference/sf_delete_attachment.html">sf_delete_attachment()</a></code>, which simply
wraps <code><a href="../reference/sf_delete.html">sf_delete()</a></code> so feel free to use for clarity in your
code that you’re working with attachments use
<code><a href="../reference/sf_delete.html">sf_delete()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sf_delete_attachment.html">sf_delete_attachment</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="va">create_result</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   id                 success</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 00PKg000001EiCvMAK TRUE</span></span>
<span><span class="co"># sf_delete(ids = create_result$id) # would also work</span></span></code></pre></div>
<p><strong>Uploading large batches of attachments using the Bulk
API</strong></p>
<p>The SOAP and REST APIs are good for working with a few attachments at
a time. However, the Bulk API can be invoked using api_type=“Bulk 1.0”
to automatically take a <code>data.frame</code> or <code>tbl_df</code>
of Attachment field data and create a ZIP file with CSV manifest that is
required by that API to upload. In the example above, we downloaded the
three attachments each belonging to two different parent records.
Assuming that I have run that code and the files are in that my computer
I can demonstrate that all of them can be uploaded at once using the
Bulk 1.0 API.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create the attachment metadata required (Name, Body, ParentId)</span></span>
<span><span class="va">attachment_details</span> <span class="op">&lt;-</span> <span class="va">queried_attachments</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">Path</span>, <span class="va">Name</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Name</span>, <span class="va">Body</span>, <span class="va">ParentId</span><span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sf_create_attachment.html">sf_create_attachment</a></span><span class="op">(</span><span class="va">attachment_details</span>, api_type<span class="op">=</span><span class="st">"Bulk 1.0"</span><span class="op">)</span></span>
<span><span class="va">result</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 4</span></span></span>
<span><span class="co">#&gt;   Id                 Success Created Error</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 00PKg000001EiD0MAK TRUE    TRUE    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 00PKg000001EiD1MAK TRUE    TRUE    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 00PKg000001EiD2MAK TRUE    TRUE    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 00PKg000001EiD3MAK TRUE    TRUE    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 00PKg000001EiD4MAK TRUE    TRUE    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more rows</span></span></span></code></pre></div>
<p><strong>NOTE</strong>: As of v48.0 (Spring ’20), it does not appear
that the Bulk 2.0 API supports working with Attachments, so the Bulk 1.0
API must be used for bulk functionality.</p>
<p>Finally, you are able to update Attachments with the Bulk API just as
shown above in the REST/SOAP API examples.</p>
</div>
<div class="section level2">
<h2 id="extending-to-documents-and-other-blob-data">Extending to Documents and Other Blob Data<a class="anchor" aria-label="anchor" href="#extending-to-documents-and-other-blob-data"></a>
</h2>
<p>The commands for working with Attachments also work for uploading
documents and other blob data as well. Documents are just like
Attachments in Salesforce except instead of having an associated
ParentId they have an associated FolderId where the blob will be
associated with upon creation. Here is a brief example of uploading a
PDF (“Document”) to a Folder</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the function supports inserting all types of blob content, just update the </span></span>
<span><span class="co"># object_name argument to add the PDF as a Document instead of an Attachment</span></span>
<span><span class="va">document_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>Name <span class="op">=</span> <span class="st">"Data Wrangling Cheatsheet - Test 1"</span>,</span>
<span>                           Description <span class="op">=</span> <span class="st">"RStudio cheatsheet covering dplyr and tidyr."</span>,</span>
<span>                           Body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, </span>
<span>                                              <span class="st">"data-wrangling-cheatsheet.pdf"</span>,</span>
<span>                                              package<span class="op">=</span><span class="st">"salesforcer"</span><span class="op">)</span>,</span>
<span>                           FolderId <span class="op">=</span> <span class="st">"00l6A000001EgIwQAK"</span>,</span>
<span>                           Keywords <span class="op">=</span> <span class="st">"test,cheatsheet,document"</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sf_create_attachment.html">sf_create_attachment</a></span><span class="op">(</span><span class="va">document_details</span>, object_name <span class="op">=</span> <span class="st">"Document"</span><span class="op">)</span></span>
<span><span class="va">result</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   id                 success</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 015Kg000000x3bJIAQ TRUE</span></span></code></pre></div>
<p>With Documents, users are also able to save storage by specifying a
<code>Url</code> instead of a a file path where the <code>Body</code>
content is stored locally. Specifying the <code>Url</code> field will
reference the URL instead of uploading into the Salesforce org, thereby
saving space if limited in your organization.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cheatsheet_url</span> <span class="op">&lt;-</span> <span class="st">"https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf"</span></span>
<span><span class="va">document_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>Name <span class="op">=</span> <span class="st">"Data Wrangling Cheatsheet - Test 2"</span>,</span>
<span>                           Description <span class="op">=</span> <span class="st">"RStudio cheatsheet covering dplyr and tidyr."</span>,</span>
<span>                           Url <span class="op">=</span> <span class="va">cheatsheet_url</span>,  </span>
<span>                           FolderId <span class="op">=</span> <span class="st">"00l6A000001EgIwQAK"</span>,</span>
<span>                           Keywords <span class="op">=</span> <span class="st">"test,cheatsheet,document"</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sf_create_attachment.html">sf_create_attachment</a></span><span class="op">(</span><span class="va">document_details</span>, object_name <span class="op">=</span> <span class="st">"Document"</span><span class="op">)</span></span>
<span><span class="va">result</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   id                 success</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 015Kg000000x3bOIAQ TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reference-links">Reference Links<a class="anchor" aria-label="anchor" href="#reference-links"></a>
</h2>
<p>Below is a list of links to existing Salesforce documentation that
provide more detail into how Attachments, Documents, and other blob data
are handled via their APIs. As with many functions in {salesforcer}, we
have tried to translate these functions exactly as they are described in
the Salesforce documentation so that they are flexible enough to handle
most all cases that the APIs were intended to support.</p>
<ul>
<li><p><strong>Attachment Object</strong>:
<a href="https://developer.salesforce.com/docs/atlas.en-us.object_reference.meta/object_reference/sforce_api_objects_attachment.htm" rel="noopener noreferrer" target="_blank" class="external-link">https://developer.salesforce.com/docs/atlas.en-us.object_reference.meta/object_reference/sforce_api_objects_attachment.htm</a></p></li>
<li><p><strong>Document Object</strong>:
<a href="https://developer.salesforce.com/docs/atlas.en-us.object_reference.meta/object_reference/sforce_api_objects_document.htm" rel="noopener noreferrer" target="_blank" class="external-link">https://developer.salesforce.com/docs/atlas.en-us.object_reference.meta/object_reference/sforce_api_objects_document.htm</a></p></li>
<li><p><strong>REST API Upload Attachment</strong>:
<a href="https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/dome_sobject_insert_update_blob.htm" rel="noopener noreferrer" target="_blank" class="external-link">https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/dome_sobject_insert_update_blob.htm</a></p></li>
<li><p><strong>Bulk API Upload Attachments</strong>:
<a href="https://developer.salesforce.com/docs/atlas.en-us.api_asynch.meta/api_asynch/binary_intro.htm" rel="noopener noreferrer" target="_blank" class="external-link">https://developer.salesforce.com/docs/atlas.en-us.api_asynch.meta/api_asynch/binary_intro.htm</a></p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steven M. Mortimer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
