<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with Attachments • salesforcer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Working with Attachments">
<meta property="og:description" content="salesforcer">
<meta property="og:image" content="https://stevenmmortimer.github.io/salesforcer/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-98603021-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-98603021-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">salesforcer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting-started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/supported-queries.html">Supported Queries</a>
    </li>
    <li>
      <a href="../articles/working-with-bulk-apis.html">Working with Bulk APIs</a>
    </li>
    <li>
      <a href="../articles/working-with-reports.html">Working with Reports</a>
    </li>
    <li>
      <a href="../articles/working-with-attachments.html">Working with Attachments</a>
    </li>
    <li>
      <a href="../articles/working-with-metadata.html">Working with Metadata</a>
    </li>
    <li>
      <a href="../articles/passing-control-args.html">Passing Control Args</a>
    </li>
    <li>
      <a href="../articles/transitioning-from-RForcecom.html">Transitioning from RForcecom</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Reference
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/StevenMMortimer/salesforcer" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with Attachments</h1>
                        <h4 data-toc-skip class="author">Steven M. Mortimer</h4>
            
            <h4 data-toc-skip class="date">2020-08-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/StevenMMortimer/salesforcer/blob/HEAD/vignettes/working-with-attachments.Rmd" class="external-link"><code>vignettes/working-with-attachments.Rmd</code></a></small>
      <div class="hidden name"><code>working-with-attachments.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="attachments-in-salesforce">Attachments in Salesforce<a class="anchor" aria-label="anchor" href="#attachments-in-salesforce"></a>
</h2>
<p>Almost all records in Salesforce support attachments. Attachments are just blob data storage for an associated ParentId. A ParentId is the 18-character Salesforcer Id of the record that the attachment belongs to. To get started creating and updating attachments, first, load the {salesforcer} and {dplyr} packages and login, if needed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/StevenMMortimer/salesforcer" class="external-link">salesforcer</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/sf_auth.html">sf_auth</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The Attachment data, for example, the attachment’s Id, ParentId, Name, Body, ModifiedDate, and other attributes are stored in the Attachment object, a Standard Object in Salesforce.</p>
</div>
<div class="section level2">
<h2 id="creating-uploading-attachments">Creating (Uploading) Attachments<a class="anchor" aria-label="anchor" href="#creating-uploading-attachments"></a>
</h2>
<p>Below we will cover 2 different methods of creating attachments:</p>
<ol style="list-style-type: decimal">
<li>Uploading local files as Attachments one at a time using the SOAP and REST API (most common usage)</li>
<li>Uploading large batches of files using the Bulk API, which zips the files before upload</li>
</ol>
<p><strong>Uploading local files as Attachments (SOAP and REST)</strong></p>
<p>When uploading an attachment stored locally (i.e. on your computer), you can provide an absolute or relative path to the current working directory. If the <code>Name</code> column is omitted, then the name of the attachment as it appears in Salesforce will be the same as the base file name and extension. For example, if the path provided is “/Documents/attachments/doc1.pdf”, then the <code>Name</code> field will be set to “doc1.pdf”.</p>
<p>In the example below, we upload three attachments to two different parent records. Note: Make sure to replace the paths and ParentIds in the example below with file paths that exist on your local machine and Ids of records in your Salesforce org.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define the ParentIds where the attachments will be shown in Salesforce</span>
<span class="va">parent_record_id1</span> <span class="op">&lt;-</span> <span class="st">"0016A0000035mJ4"</span>
<span class="va">parent_record_id2</span> <span class="op">&lt;-</span> <span class="st">"0016A0000035mJ5"</span>

<span class="co"># provide the file paths of where the attachments exist locally on your machine</span>
<span class="co"># in this case we are referencing images included within the salesforcer package, </span>
<span class="co"># but any absolute or relative path locally will work</span>
<span class="va">file_path1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"cloud.png"</span>, package<span class="op">=</span><span class="st">"salesforcer"</span><span class="op">)</span>
<span class="va">file_path2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"logo.png"</span>, package<span class="op">=</span><span class="st">"salesforcer"</span><span class="op">)</span>
<span class="va">file_path3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"old-logo.png"</span>, package<span class="op">=</span><span class="st">"salesforcer"</span><span class="op">)</span>

<span class="co"># create a data.frame or tbl_df out of this information</span>
<span class="va">attachment_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>Body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">file_path1</span>, 
                                          <span class="va">file_path2</span>, 
                                          <span class="va">file_path3</span><span class="op">)</span>, 
                                        times<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,
                             ParentId <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">parent_record_id1</span>, 
                                              <span class="va">parent_record_id2</span><span class="op">)</span>, 
                                            each<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>

<span class="co"># create the attachments!</span>
<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sf_create_attachment.html">sf_create_attachment</a></span><span class="op">(</span><span class="va">attachment_details</span><span class="op">)</span>
<span class="va">result</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span>
<span class="co">#&gt;   id                 success</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 00P3s00000gWmlHEAS TRUE   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 00P3s00000gWmlMEAS TRUE   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 00P3s00000gWmlREAS TRUE   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 00P3s00000gWmlWEAS TRUE   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 00P3s00000gWmlbEAC TRUE   </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 1 more row</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="downloading-attachments">Downloading Attachments<a class="anchor" aria-label="anchor" href="#downloading-attachments"></a>
</h2>
<p>After uploading attachments to Salesforce you can download them by first querying the metadata in the Attachment object. This metadata provides the Id for the blob data attachment for download. A convenience function, <code><a href="../reference/sf_download_attachment.html">sf_download_attachment()</a></code>, has been created to download attachments quickly. The example below shows how to query the metadata of attachments belonging to particular ParentId.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># pull down all attachments associated with a particular record</span>
<span class="va">queried_attachments</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sf_query.html">sf_query</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"SELECT Id, Body, Name, ParentId
                                         FROM Attachment
                                         WHERE ParentId IN ('%s', '%s')"</span>, 
                                         <span class="va">parent_record_id1</span>, <span class="va">parent_record_id2</span><span class="op">)</span><span class="op">)</span>
<span class="va">queried_attachments</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span>
<span class="co">#&gt;   Id                 Body                                 Name     ParentId     </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 00P3s00000gWmlHEAS /services/data/v52.0/sobjects/Attac… cloud.p… 0016A0000035…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 00P3s00000gWmlMEAS /services/data/v52.0/sobjects/Attac… logo.png 0016A0000035…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 00P3s00000gWmlREAS /services/data/v52.0/sobjects/Attac… old-log… 0016A0000035…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 00P3s00000gWmlbEAC /services/data/v52.0/sobjects/Attac… logo.png 0016A0000035…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 00P3s00000gWmlWEAS /services/data/v52.0/sobjects/Attac… cloud.p… 0016A0000035…</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 1 more row</span></span></code></pre></div>
<p>Before downloading the attachments using the Body it is important to consider whether the attachment names are repeated or duplicates. If so, then the attachments with the same exact name will be overwritten on the local filesystem as they are downloaded. To avoid this problem there are two common strategies:</p>
<ol style="list-style-type: decimal">
<li>Create a new column (e.g. <code>unique_name</code>) that is the concatenation of the Attachment Id and the Attachment’s name which is guaranteed to be unique.</li>
<li>Save the attachments in separate folders for each ParentId record.</li>
</ol>
<p>As long as the same ParentId record doesn’t name attachments with the same name, then Strategy #2 above will work. In addition, it may help better organize the documents if you are planning to download many and then upload again to Salesforce using the Bulk API as demonstrated later in this script.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create a new folder for each ParentId in the dataset</span>
<span class="va">temp_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">pid</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">queried_attachments</span><span class="op">$</span><span class="va">ParentId</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="va">pid</span><span class="op">)</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># ignore if already exists</span>
<span class="op">}</span>

<span class="co"># create a new columns in the queried data so that we can pass this information </span>
<span class="co"># on to the function `sf_download_attachment()` that will actually perform the download</span>
<span class="va">queried_attachments</span> <span class="op">&lt;-</span> <span class="va">queried_attachments</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="co"># Strategy 1: Unique file names (ununsed here, but shown as an example)</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>unique_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">Id</span>, <span class="va">Name</span>, sep<span class="op">=</span><span class="st">'___'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="co"># Strategy 2: Separate folders per parent</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="va">ParentId</span><span class="op">)</span><span class="op">)</span>

<span class="co"># download all of the attachments for a single ParentId record to their own folder</span>
<span class="va">download_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">sf_download_attachment</span>, 
                          body <span class="op">=</span> <span class="va">queried_attachments</span><span class="op">$</span><span class="va">Body</span>, 
                          name <span class="op">=</span> <span class="va">queried_attachments</span><span class="op">$</span><span class="va">Name</span>, 
                          path <span class="op">=</span> <span class="va">queried_attachments</span><span class="op">$</span><span class="va">Path</span><span class="op">)</span>
<span class="va">download_result</span>
<span class="co">#&gt;                               /services/data/v52.0/sobjects/Attachment/00P3s00000gWmlHEAS/Body </span>
<span class="co">#&gt;    "/var/folders/s2/1mxmzrg52tx7l0pg8lq1320w0000gn/T//Rtmpo0EfUa/0016A0000035mJ4QAI/cloud.png" </span>
<span class="co">#&gt;                               /services/data/v52.0/sobjects/Attachment/00P3s00000gWmlMEAS/Body </span>
<span class="co">#&gt;     "/var/folders/s2/1mxmzrg52tx7l0pg8lq1320w0000gn/T//Rtmpo0EfUa/0016A0000035mJ4QAI/logo.png" </span>
<span class="co">#&gt;                               /services/data/v52.0/sobjects/Attachment/00P3s00000gWmlREAS/Body </span>
<span class="co">#&gt; "/var/folders/s2/1mxmzrg52tx7l0pg8lq1320w0000gn/T//Rtmpo0EfUa/0016A0000035mJ4QAI/old-logo.png" </span>
<span class="co">#&gt;                               /services/data/v52.0/sobjects/Attachment/00P3s00000gWmlbEAC/Body </span>
<span class="co">#&gt;     "/var/folders/s2/1mxmzrg52tx7l0pg8lq1320w0000gn/T//Rtmpo0EfUa/0016A0000035mJ5QAI/logo.png" </span>
<span class="co">#&gt;                               /services/data/v52.0/sobjects/Attachment/00P3s00000gWmlWEAS/Body </span>
<span class="co">#&gt;    "/var/folders/s2/1mxmzrg52tx7l0pg8lq1320w0000gn/T//Rtmpo0EfUa/0016A0000035mJ5QAI/cloud.png" </span>
<span class="co">#&gt;                               /services/data/v52.0/sobjects/Attachment/00P3s00000gWmlgEAC/Body </span>
<span class="co">#&gt; "/var/folders/s2/1mxmzrg52tx7l0pg8lq1320w0000gn/T//Rtmpo0EfUa/0016A0000035mJ5QAI/old-logo.png"</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="updating-attachments">Updating Attachments<a class="anchor" aria-label="anchor" href="#updating-attachments"></a>
</h2>
<p>Once an Attachment record is created, you are still able to update the content and metadata (<code>Name</code>, <code>IsPrivate</code>, and <code>OwnerId</code>) for the record. The <code><a href="../reference/sf_update_attachment.html">sf_update_attachment()</a></code> function works just like <code><a href="../reference/sf_update.html">sf_update()</a></code> except that you will need to include the <code>Body</code> column where the content of the attachment is help. <strong>NOTE</strong>: If you just want to update the metadata and not the Attachment content itself, you can simply use <code><a href="../reference/sf_update.html">sf_update()</a></code> to modify fields other than the <code>Body</code> field on the record.</p>
<p>The example below demonstrates how to add an attachment to a record, then download it, zip it, re-upload to the record in order to save disk space in your Org.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># upload a PDF to a particular record as an Attachment</span>
<span class="va">file_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,
                         <span class="st">"data-wrangling-cheatsheet.pdf"</span>,
                         package <span class="op">=</span> <span class="st">"salesforcer"</span><span class="op">)</span>
<span class="va">parent_record_id</span> <span class="op">&lt;-</span> <span class="st">"0036A000002C6MmQAK"</span> <span class="co"># replace with your own ParentId!</span>
<span class="va">attachment_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>Body <span class="op">=</span> <span class="va">file_path</span>, ParentId <span class="op">=</span> <span class="va">parent_record_id</span><span class="op">)</span>
<span class="va">create_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sf_create_attachment.html">sf_create_attachment</a></span><span class="op">(</span><span class="va">attachment_details</span><span class="op">)</span>

<span class="co"># download, zip, and re-upload the PDF</span>
<span class="va">pdf_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sf_download_attachment.html">sf_download_attachment</a></span><span class="op">(</span>sf_id <span class="op">=</span> <span class="va">create_result</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">zipped_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">pdf_path</span>, <span class="st">".zip"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/zip.html" class="external-link">zip</a></span><span class="op">(</span><span class="va">zipped_path</span>, <span class="va">pdf_path</span>, flags <span class="op">=</span> <span class="st">"-qq"</span><span class="op">)</span> <span class="co"># quiet zipping messages</span>
<span class="va">attachment_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>Id <span class="op">=</span> <span class="va">create_result</span><span class="op">$</span><span class="va">id</span>, Body <span class="op">=</span> <span class="va">zipped_path</span><span class="op">)</span>
<span class="fu"><a href="../reference/sf_update_attachment.html">sf_update_attachment</a></span><span class="op">(</span><span class="va">attachment_details</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span>
<span class="co">#&gt;   id                 success</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 00P3s00000gWmllEAC TRUE</span></code></pre></div>
<p>There is a function <code><a href="../reference/sf_delete_attachment.html">sf_delete_attachment()</a></code>, which simply wraps <code><a href="../reference/sf_delete.html">sf_delete()</a></code> so feel free to use for clarity in your code that you’re working with attachments use <code><a href="../reference/sf_delete.html">sf_delete()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/sf_delete_attachment.html">sf_delete_attachment</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="va">create_result</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span>
<span class="co">#&gt;   id                 success</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 00P3s00000gWmllEAC TRUE</span>
<span class="co"># sf_delete(ids = create_result$id) # would also work</span></code></pre></div>
<p><strong>Uploading large batches of attachments using the Bulk API</strong></p>
<p>The SOAP and REST APIs are good for working with a few attachments at a time. However, the Bulk API can be invoked using api_type=“Bulk 1.0” to automatically take a <code>data.frame</code> or <code>tbl_df</code> of Attachment field data and create a ZIP file with CSV manifest that is required by that API to upload. In the example above, we downloaded the three attachments each belonging to two different parent records. Assuming that I have run that code and the files are in that my computer I can demonstrate that all of them can be uploaded at once using the Bulk 1.0 API.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create the attachment metadata required (Name, Body, ParentId)</span>
<span class="va">attachment_details</span> <span class="op">&lt;-</span> <span class="va">queried_attachments</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">Path</span>, <span class="va">Name</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Name</span>, <span class="va">Body</span>, <span class="va">ParentId</span><span class="op">)</span> </code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sf_create_attachment.html">sf_create_attachment</a></span><span class="op">(</span><span class="va">attachment_details</span>, api_type<span class="op">=</span><span class="st">"Bulk 1.0"</span><span class="op">)</span>
<span class="va">result</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span>
<span class="co">#&gt;   Id                 Success Created Error</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 00P3s00000gWmlqEAC TRUE    TRUE    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 00P3s00000gWmlrEAC TRUE    TRUE    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 00P3s00000gWmlsEAC TRUE    TRUE    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 00P3s00000gWmltEAC TRUE    TRUE    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 00P3s00000gWmluEAC TRUE    TRUE    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 1 more row</span></span></code></pre></div>
<p><strong>NOTE</strong>: As of v48.0 (Spring ’20), it does not appear that the Bulk 2.0 API supports working with Attachments, so the Bulk 1.0 API must be used for bulk functionality.</p>
<p>Finally, you are able to update Attachments with the Bulk API just as shown above in the REST/SOAP API examples.</p>
</div>
<div class="section level2">
<h2 id="extending-to-documents-and-other-blob-data">Extending to Documents and Other Blob Data<a class="anchor" aria-label="anchor" href="#extending-to-documents-and-other-blob-data"></a>
</h2>
<p>The commands for working with Attachments also work for uploading documents and other blob data as well. Documents are just like Attachments in Salesforce except instead of having an associated ParentId they have an associated FolderId where the blob will be associated with upon creation. Here is a brief example of uploading a PDF (“Document”) to a Folder</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the function supports inserting all types of blob content, just update the </span>
<span class="co"># object_name argument to add the PDF as a Document instead of an Attachment</span>
<span class="va">document_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>Name <span class="op">=</span> <span class="st">"Data Wrangling Cheatsheet - Test 1"</span>,
                           Description <span class="op">=</span> <span class="st">"RStudio cheatsheet covering dplyr and tidyr."</span>,
                           Body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, 
                                              <span class="st">"data-wrangling-cheatsheet.pdf"</span>,
                                              package<span class="op">=</span><span class="st">"salesforcer"</span><span class="op">)</span>,
                           FolderId <span class="op">=</span> <span class="st">"00l6A000001EgIwQAK"</span>,
                           Keywords <span class="op">=</span> <span class="st">"test,cheatsheet,document"</span><span class="op">)</span>
<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sf_create_attachment.html">sf_create_attachment</a></span><span class="op">(</span><span class="va">document_details</span>, object_name <span class="op">=</span> <span class="st">"Document"</span><span class="op">)</span>
<span class="va">result</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span>
<span class="co">#&gt;   id                 success</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0153s000002btfWAAQ TRUE</span></code></pre></div>
<p>With Documents, users are also able to save storage by specifying a <code>Url</code> instead of a a file path where the <code>Body</code> content is stored locally. Specifying the <code>Url</code> field will reference the URL instead of uploading into the Salesforce org, thereby saving space if limited in your organization.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cheatsheet_url</span> <span class="op">&lt;-</span> <span class="st">"https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf"</span>
<span class="va">document_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>Name <span class="op">=</span> <span class="st">"Data Wrangling Cheatsheet - Test 2"</span>,
                           Description <span class="op">=</span> <span class="st">"RStudio cheatsheet covering dplyr and tidyr."</span>,
                           Url <span class="op">=</span> <span class="va">cheatsheet_url</span>,  
                           FolderId <span class="op">=</span> <span class="st">"00l6A000001EgIwQAK"</span>,
                           Keywords <span class="op">=</span> <span class="st">"test,cheatsheet,document"</span><span class="op">)</span>
<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sf_create_attachment.html">sf_create_attachment</a></span><span class="op">(</span><span class="va">document_details</span>, object_name <span class="op">=</span> <span class="st">"Document"</span><span class="op">)</span>
<span class="va">result</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span>
<span class="co">#&gt;   id                 success</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0153s000002btfbAAA TRUE</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reference-links">Reference Links<a class="anchor" aria-label="anchor" href="#reference-links"></a>
</h2>
<p>Below is a list of links to existing Salesforce documentation that provide more detail into how Attachments, Documents, and other blob data are handled via their APIs. As with many functions in {salesforcer}, we have tried to translate these functions exactly as they are described in the Salesforce documentation so that they are flexible enough to handle most all cases that the APIs were intended to support.</p>
<ul>
<li><p><strong>Attachment Object</strong>: <a href="https://developer.salesforce.com/docs/atlas.en-us.api.meta/api/sforce_api_objects_attachment.htm" rel="noopener noreferrer" target="_blank" class="external-link">https://developer.salesforce.com/docs/atlas.en-us.api.meta/api/sforce_api_objects_attachment.htm</a></p></li>
<li><p><strong>Document Object</strong>: <a href="https://developer.salesforce.com/docs/atlas.en-us.api.meta/api/sforce_api_objects_document.htm" rel="noopener noreferrer" target="_blank" class="external-link">https://developer.salesforce.com/docs/atlas.en-us.api.meta/api/sforce_api_objects_document.htm</a></p></li>
<li><p><strong>REST API Upload Attachment</strong>: <a href="https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/dome_sobject_insert_update_blob.htm" rel="noopener noreferrer" target="_blank" class="external-link">https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/dome_sobject_insert_update_blob.htm</a></p></li>
<li><p><strong>Bulk API Upload Attachments</strong>: <a href="https://developer.salesforce.com/docs/atlas.en-us.api_asynch.meta/api_asynch/binary_intro.htm" rel="noopener noreferrer" target="_blank" class="external-link">https://developer.salesforce.com/docs/atlas.en-us.api_asynch.meta/api_asynch/binary_intro.htm</a></p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Steven M. Mortimer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    appId: 'BBX5BTLUTL',
    
    apiKey: 'f3a7c81cd6794f9050f32bfee2620882',
    indexName: 'salesforcer',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
